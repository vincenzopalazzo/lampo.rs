//! Event generated by onchain events.
use std::fmt::Debug;

use crate::bitcoin::absolute::Height;
use crate::bitcoin::block::Header;
use crate::bitcoin::{Block, Transaction, Txid};

#[derive(Clone)]
pub enum OnChainEvent {
    NewBlock(Block),
    NewBestBlock((Header, Height)),
    FeeEstimation(u32),
    SendRawTransaction(Transaction),
    ConfirmedTransaction((Transaction, u32, Header, Height)),
    DiscardedTransaction(Txid),
    UnconfirmedTransaction(Txid),
}

impl Debug for OnChainEvent {
    fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {
        match self {
            Self::ConfirmedTransaction((tx, idx, header, height)) => write!(
                f,
                "ConfirmedTransaction(txid: {}, idx {idx}, block: {:?}, height: {height})",
                tx.compute_txid(),
                header
            ),
            Self::NewBestBlock((header, height)) => {
                write!(f, "NewBestBlock({}, {height})", header.block_hash())
            }
            Self::NewBlock(block) => write!(f, "NewBlock({})", block.block_hash()),
            Self::SendRawTransaction(tx) => write!(f, "SendRawTransaction({})", tx.compute_txid()),
            Self::UnconfirmedTransaction(tx) => write!(f, "UnconfirmedTransaction({})", tx),
            _ => write!(f, "Debug fmt not unsupported"),
        }
    }
}
